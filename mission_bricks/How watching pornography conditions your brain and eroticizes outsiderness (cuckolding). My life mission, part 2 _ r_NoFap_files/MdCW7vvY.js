SML.di("./CVEbQKiO.js",import.meta.url,"CVEbQKiO");SML.di("./Btl6S_1h.js",import.meta.url,"Btl6S_1h");SML.di("./D7lSuCop.js",import.meta.url,"D7lSuCop");SML.di("./CK9FveTr.js",import.meta.url,"CK9FveTr");SML.di("./BcR8gLw3.js",import.meta.url,"BcR8gLw3");SML.di("./BxmAGM9T.js",import.meta.url,"BxmAGM9T");SML.di("./-FBlaqnE.js",import.meta.url,"-FBlaqnE");SML.di("./kExRqc7d.js",import.meta.url,"kExRqc7d");SML.di("./DEQ-l4mm.js",import.meta.url,"DEQ-l4mm");SML.di("./B_ByM_ya.js",import.meta.url,"B_ByM_ya");SML.di("./GpA9mJze.js",import.meta.url,"GpA9mJze");SML.di("./B92R8McT.js",import.meta.url,"B92R8McT");SML.di("./CCOsF7IJ.js",import.meta.url,"CCOsF7IJ");SML.di("./Mh6HSk7W.js",import.meta.url,"Mh6HSk7W");SML.di("./D9dm-Sy6.js",import.meta.url,"D9dm-Sy6");SML.di("./BMNJiqQ9.js",import.meta.url,"BMNJiqQ9");SML.di("./B8BAxqC_.js",import.meta.url,"B8BAxqC_");SML.di("./DsV3drw0.js",import.meta.url,"DsV3drw0");SML.di("./CCphb8vV.js",import.meta.url,"CCphb8vV");SML.di("./CU4mObWU.js",import.meta.url,"CU4mObWU");SML.di("./CK47trMR.js",import.meta.url,"CK47trMR");SML.di("./BC8XSJYX.js",import.meta.url,"BC8XSJYX");SML.di("./LCU6ttla.js",import.meta.url,"LCU6ttla");
SML.dm("MdCW7vvY",["CVEbQKiO","Btl6S_1h","D7lSuCop","CK9FveTr","BcR8gLw3","BxmAGM9T","-FBlaqnE","kExRqc7d","DEQ-l4mm","B_ByM_ya","GpA9mJze","B92R8McT","CCOsF7IJ","Mh6HSk7W","D9dm-Sy6","BMNJiqQ9","B8BAxqC_","DsV3drw0","CCphb8vV","CU4mObWU","CK47trMR","BC8XSJYX","LCU6ttla"],(async(e,t,a,i,n,s,o)=>{var r;!function(e){e.GREAT="great",e.NOT_GREAT="not great"}(r||(r={}));let l=class extends e.s{constructor(){super(...arguments),this.otherReasonFormValue="",this.isOpen=!1,this.handleDismiss=()=>{a.e(this,s.n()),this.close()}}show(){a.e(this,s.m()),this.faceplateDialog?.showModal?.(),this.isOpen=!0}close(){this.faceplateDialog?.close?.(),this.isOpen=!1,this.selectedOption=void 0,this.otherReasonFormValue=""}showThankYouAlert(){this.dispatchEvent(a.c("faceplate-alert",{level:a.a4.success,message:"Thanks for rating"}))}handleUpvoteTranslation(){this.selectedOption=r.GREAT}handleDownvoteTranslation(){this.selectedOption=r.NOT_GREAT}handleSubmit(){this.selectedOption&&(a.e(this,s.o({reason:this.selectedOption,survey_text:this.otherReasonFormValue})),this.showThankYouAlert(),this.close())}render(){return e.x` <faceplate-dialog id="global-translation-feedback-faceplate-dialog" class="translation-feedback"> <div class="flex flex-col gap-lg"> <div class="flex justify-between"> <h3 class="font-bold text-24 text-neutral-content-strong m-0" data-testid="modal-title"> ${"Enjoying these translations?"} </h3> ${a.k({attributes:{onclick:this.handleDismiss},appearance:"secondary",leadingIcon:e.C({size:e.q.Medium}),size:a._.Medium})} </div> <p class="m-0" data-testid="modal-subtitle"> ${"Tell us what you think about your translated Reddit experience."} </p> <div class="flex justify-center gap-md"> <button data-testid="upvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===r.GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleUpvoteTranslation}" @keydown="${this.handleUpvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Smile_EyesOpen.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> ${"Great"} </p> </button> <button data-testid="downvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===r.NOT_GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleDownvoteTranslation}" @keydown="${this.handleDownvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Blanc.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> ${"Not Great"} </p> </button> </div> ${this.selectedOption?e.x` <div class="flex w-full box-border"> <faceplate-textarea-input data-testid="other-reason-input" maxlength="500" appearance="${n.a.BORDERED}" size="${n.T.EXPANDED}" @keyup="${e=>{e.stopPropagation(),this.otherReasonFormValue=e.target.value}}" class="w-full" .value="${this.otherReasonFormValue}"> <span slot="label">${"Leave a comment (optional)"}</span> </faceplate-textarea-input> </div> `:e.x``} <div class="flex justify-end"> ${a.k({appearance:"primary",size:a._.Large,shape:"pill",attributes:{onclick:this.handleSubmit,className:"flex box-border","data-testid":"submit-feedback-button",disabled:!this.selectedOption},children:e.x`<span class="font-semibold text-14">${"Give Feedback"}</span>`})} </div> </div> </faceplate-dialog> `;}};l.styles=[e.i`.translation-feedback{border-radius:16px;max-width:400px;padding:2rem 1.5rem 1.5rem 1.5rem;width:82%}`,a.t],e._([e.z("#global-translation-feedback-faceplate-dialog")],l.prototype,"faceplateDialog",void 0),e._([e.b()],l.prototype,"selectedOption",void 0),e._([e.b()],l.prototype,"otherReasonFormValue",void 0),e._([e.b()],l.prototype,"isOpen",void 0),l=e._([e.c("global-translation-feedback-modal")],l);const d="data-protection-consent",c="faceplate-bottom-sheet#xpromo-bottom-sheet",u="faceplate-modal#blocking-modal",m=e.s;function h(e){return!!e?.open}let p=class extends m{constructor(){super(...arguments),this.activatableFeatures=[a.gy,a.gz,a.gA,a.gB],this.isDesktop=!1,this.withFeedback=!1,this.withActivatedFeatures=!1,this.translationContextValue=a.at,this.withCoachmark=!1,this.withTranslationSettings=!1,this.userLocale="",this.hasCoachmarkDisplayLimit=!1,this.translationActiveMsg="Translations enabled",this.handleTranslationActiveSwitch=()=>{const e=!this.translationContextValue.isTranslationActive;this.dispatchContextUpdateEvent({isTranslationActive:e})},this.closeTranslationCoachmark=()=>{this.translationCoachmark?.hide?.(),this.onCoachmarkClose()},this.openTranslationCoachmark=()=>{a.e(this,o.e(!!this.translationContextValue.isTranslationActive)),this.translationCoachmark?.show?.()},this.openTranslationMenu=()=>{a.e(this,o.f(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.show?.():this.translationMenuBottomSheet?.showModal?.()},this.closeTranslationMenu=()=>{a.e(this,o.f(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.close?.():this.translationMenuBottomSheet?.close?.()},this.openFeedbackModal=()=>{this.translationFeedbackModal?.show?.()},this.handleCoachmarkSettingsClick=()=>{this.closeTranslationCoachmark(),this.openTranslationMenu(),a.e(this,o.g(o.h.UpdateSettings))},this.handleTranslationActiveClick=e=>{e.stopPropagation(),a.e(this,s.p(!!this.translationContextValue.isTranslationActive,this.userLocale))},this.handleCoachmarkClick=e=>{e.stopPropagation()},this.handleCoachmarkCloseClick=()=>{this.closeTranslationCoachmark(),a.e(this,o.g(o.h.Dismiss))},this.handleNavMobileButtonClick=()=>{this.activateFeatures(),this.openTranslationMenu(),a.e(this,o.i(!!this.translationContextValue.isTranslationActive))},this.handleNavbarButtonClick=()=>{this.activateFeatures(),a.e(this,o.i(!!this.translationContextValue.isTranslationActive)),a.e(this,o.f(!!this.translationContextValue.isTranslationActive))},this.handleGiveFeedbackButtonClick=()=>{this.openFeedbackModal(),this.closeTranslationMenu()},this.onCoachmarkClose=()=>{setTimeout((()=>{this.dispatchContextUpdateEvent({shouldDisplayCoachmark:!1,shouldDisplayFeedbackCoachmark:!0})}),500)},this._activateFeature=a.f}connectedCallback(){super.connectedCallback();"mtseo-disabled"===a.l.getItem(a.L.I18nTranslationInterventionShown)&&(setTimeout((()=>{this.dispatchEvent(a.c("faceplate-alert",{level:a.a4.success,message:"Translations are disabled."}))}),1e3),a.l.setItem(a.L.I18nTranslationInterventionShown,"true"))}updated(e){this.withCoachmark&&!this.hasCoachmarkDisplayLimit&&e.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&this.displayCoachmark()}displayCoachmark(){const{coachmarkDisplayCount:e,shouldDisplayCoachmark:t}=this.translationContextValue;window.setTimeout((()=>{if(!t)return;if(this.hasCoachmarkObstacles())return;const a=e<1;this.dispatchContextUpdateEvent({coachmarkDisplayCount:e+1,shouldDisplayCoachmark:a,shouldDisplayFeedbackCoachmark:!a}),a&&this.openTranslationCoachmark(),this.hasCoachmarkDisplayLimit=!0}),1500)}hasCoachmarkObstacles(){const e=!!document.querySelector(d),t=function(e){const t=document.querySelector(e);return t?a.ct(h,t):[]}(c),i=!!document.querySelector(u);return e||t?.length>0||i}dispatchContextUpdateEvent(e){const t={...this.translationContextValue,...e},a=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(a)}featureShouldBeActivated(e){return!!document.querySelector(`faceplate-loader[name=${e}]`)&&!!document.querySelector(`faceplate-partial[name=${e}]`)&&!a.gC(e)}activateFeatures(){return this.withActivatedFeatures?Promise.all(this.activatableFeatures.filter(this.featureShouldBeActivated).map((e=>this._activateFeature({name:e})))):Promise.resolve()}renderCoachmark(){return this.translationContextValue.shouldDisplayCoachmark?e.x`<rpl-coachmark-card slot="content" appearance="inverted"> ${e.cg({size:e.q.Small,attributes:{slot:"title-icon"}})} <span slot="title" class="whitespace-nowrap">${this.translationActiveMsg}</span> <p class="max-w-[10rem] xs:max-w-none"> ${this.translationContextValue.isTranslationActive?"Posts and comments are automatically translated":"Automatically translate posts and comments"} </p> ${a.k({attributes:{"aria-label":"Close",id:"coachmark-close-button",onclick:this.handleCoachmarkCloseClick,slot:"close-button"},appearance:"plainInverted",leadingIcon:e.C({size:e.q.Small}),size:a._.Small})} ${a.k({attributes:{slot:"primary-button",id:"coachmark-settings-button",onclick:this.handleCoachmarkSettingsClick},children:"Settings",appearance:"plainInverted",size:a._.Small})} </rpl-coachmark-card>`:e.x``;}renderDesktopMenu(){return e.x`<faceplate-dropdown-menu position="bottom-end" id="translation-desktop-menu"> ${a.k({size:a._.Medium,appearance:"plain",shape:"pill",leadingIcon:e.af({size:e.q.Medium}),attributes:{id:"translation-menu-button","aria-label":this.translationActiveMsg,onclick:this.handleNavbarButtonClick}})} <faceplate-menu slot="menu" dropdown hidden> ${i.l({label:e.x` <faceplate-switch-input id="hui-translation-switch" appearance="${t.S.PRIMARY}" class="inline-flex flex-row-reverse gap-sm" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="-ml-xs">${this.translationActiveMsg}</span> </faceplate-switch-input> `,size:i.L.Medium})} ${this.withTranslationSettings?i.l({label:e.x` <span class="flex flex-row items-center"> ${e.bn({size:e.q.Medium})} <span class="ml-xs"> ${"Translation Settings"} </span> </span> `,attributes:{id:"translation-settings-list-item"},size:i.L.Medium,href:"/settings/preferences"}):e.A} ${this.withFeedback?i.l({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:i.L.Medium,onClick:this.handleGiveFeedbackButtonClick}):e.A} </faceplate-menu> </faceplate-dropdown-menu>`;}renderMobileMenu(){return e.x`<div> ${a.k({size:a._.Medium,appearance:"plain",shape:"pill",leadingIcon:e.af({size:e.q.Medium}),attributes:{id:"translation-menu-button",onclick:this.handleNavMobileButtonClick,"aria-label":this.translationActiveMsg}})} <faceplate-bottom-sheet id="translation-mobile-menu"> <div class="p-md flex flex-col items-stretch w-full gap-md"> <faceplate-switch-input id="hui-translation-switch" appearance="${t.S.PRIMARY}" class="flex flex-row-reverse justify-between gap-sm px-xs" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="inline-flex items-center gap-xs"> ${e.af({size:e.q.Medium})} <span> ${this.translationActiveMsg} </span> </span> </faceplate-switch-input> ${this.withFeedback?i.l({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:i.L.Medium,onClick:this.handleGiveFeedbackButtonClick}):e.A} </div> </faceplate-bottom-sheet> </div>`;}render(){return e.x` <rpl-coachmark placement="${this.isDesktop?"bottom-end":"bottom"}" appearance="inverted" id="translation-coachmark" @click="${this.handleCoachmarkClick}" @rpl-coachmark:after-hide="${this.onCoachmarkClose}" style="--max-width:fit-content"> <div>${this.isDesktop?this.renderDesktopMenu():this.renderMobileMenu()}</div> ${this.renderCoachmark()} </rpl-coachmark> ${this.withFeedback?e.x` <global-translation-feedback-modal id="hui-translation-button-feedback-modal"></global-translation-feedback-modal>`:e.A} `}};p.styles=[a.t],e._([e.n({type:Boolean,attribute:"is-desktop"})],p.prototype,"isDesktop",void 0),e._([e.n({type:Boolean,attribute:"with-feedback"})],p.prototype,"withFeedback",void 0),e._([e.n({type:Boolean,attribute:"with-activated-features"})],p.prototype,"withActivatedFeatures",void 0),e._([a.as({context:a.au,subscribe:!0}),e.b()],p.prototype,"translationContextValue",void 0),e._([e.n({type:Boolean,attribute:"with-coachmark"})],p.prototype,"withCoachmark",void 0),e._([e.n({type:Boolean,attribute:"with-translation-settings"})],p.prototype,"withTranslationSettings",void 0),e._([e.n({type:String,attribute:"user-locale"})],p.prototype,"userLocale",void 0),e._([e.b()],p.prototype,"hasCoachmarkDisplayLimit",void 0),e._([e.z("#translation-coachmark")],p.prototype,"translationCoachmark",void 0),e._([e.z("#translation-desktop-menu")],p.prototype,"translationDropdownMenu",void 0),e._([e.z("#translation-mobile-menu")],p.prototype,"translationMenuBottomSheet",void 0),e._([e.z("#hui-translation-button-feedback-modal")],p.prototype,"translationFeedbackModal",void 0),p=e._([e.c("hui-translation-button")],p);let k=class extends e.s{constructor(){super(...arguments),this.translationContextValue=a.at,this.isNewAccountAge=!1,this.isNewImmersiveVisit=!1,this.withBackendSetting=!1,this.preferredLanguages="",this.defaultImmersiveOn=!1,this.requestClientGQL=a.v}connectedCallback(){super.connectedCallback(),this.initializePreferredLanguageSettings(),this.isSettingInitialized()?this.syncTranslationSettingsWithCookie():this.initializeTranslationSettings()}updated(e){if(!e.has("translationContextValue")||!this.withBackendSetting)return;const t=e.get("translationContextValue"),a=this.translationContextValue.isTranslationActive,i=t?.isTranslationActive;if(void 0===i)return;(!0!==i&&!0===a||!1!==i&&!1===a)&&this.saveTranslationSettingInAccount(a)}async initializePreferredLanguageSettings(){const e=sessionStorage.getItem(a.L.TranslationPreferredLanguageInitialized);if(!this.preferredLanguages||!this.withBackendSetting||e)return;let t=[];try{const{data:e}=await this.requestClientGQL({operation:a.O.TranslationPreferredLanguages}),i=e?.identity?.preferences?.preferredLanguages||[];if(t=((e,t)=>{if(!t)return[];const i=e.map((e=>"en"===e?"en-US":a.gD.get(e.toLowerCase())||e)),n=new Set;t.forEach((e=>{n.add(e.isoCode)}));const s=[];return i.forEach((e=>{n.has(e)&&s.push(e)})),s})(this.preferredLanguages.split(","),e.allPreferredLanguages),0===i.length&&t.length>0){const e=(await this.requestClientGQL({operation:a.O.UpdatePreferredLanguagesPreference,variables:{input:{languages:t}}})).data.updatePreferredLanguagesPreference;e?.ok?(a.e(this,s.q("success",t)),sessionStorage.setItem(a.L.TranslationPreferredLanguageInitialized,"true")):a.e(this,s.q("failure",t,`GQL update error: ${e?.errors}`))}else i.length>0?sessionStorage.setItem(a.L.TranslationPreferredLanguageInitialized,"true"):a.e(this,s.q("failure",t,`Preferred lang not supported: ${this.preferredLanguages}`))}catch(e){const{message:i}=e;a.e(this,s.q("failure",t,`Exception thrown: ${i}`))}}async initializeTranslationSettings(){const e=this.fetchTranslationSettingFromCookie(),t=await this.fetchTranslationSettingFromGQL();let i,n={...this.translationContextValue};if(e&&(n={...n,...e}),null!==t&&t!==e?.isTranslationActive&&(n={...n,isTranslationActive:t},i=s.T.BACKEND),null===e&&null===t){const[e,t]=this.getFallbackIsTranslationActive();i=t,n={...n,isTranslationActive:e}}this.dispatchContextUpdateEvent(n),null===t&&void 0!==n.isTranslationActive&&this.saveTranslationSettingInAccount(n.isTranslationActive),i&&(n.isTranslationActive?a.e(this,s.r(i)):a.e(this,s.s(i))),sessionStorage.setItem(a.L.TranslationInitialized,Date.now().toString()),a.e(this,o.j(!!n.isTranslationActive))}getFallbackIsTranslationActive(){return this.defaultImmersiveOn?[!0,s.T.MULTILINGUAL_ON]:(this.isNewImmersiveVisit,this.isNewAccountAge?[!0,s.T.ACCOUNT_AGE]:[!1,s.T.DEFAULT_OFF])}syncTranslationSettingsWithCookie(){const e=this.fetchTranslationSettingFromCookie();let t={...this.translationContextValue};e&&e.isTranslationActive!==t.isTranslationActive&&(t={...t,...e},this.dispatchContextUpdateEvent(t)),a.e(this,o.j(!!t.isTranslationActive))}fetchTranslationSettingFromCookie(){const e=a.D.get(a.gE)??"";return a.gF(e)}async fetchTranslationSettingFromGQL(){if(!this.withBackendSetting)return null;try{const{data:e}=await this.requestClientGQL({operation:a.O.IdentityImmersiveTranslationSetting}),t=e.identity?.preferences?.isMachineTranslationImmersive;return null==t||t===a.gs.Unset?null:t===a.gs.Enabled}catch{}return null}async saveTranslationSettingInAccount(e){if(!this.withBackendSetting)return null;try{await this.requestClientGQL({operation:a.O.UpdateAccountPreferences,variables:{input:{isMachineTranslationImmersive:e?a.gs.Enabled:a.gs.Disabled}}})}catch{}return null}dispatchContextUpdateEvent(e){const t=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(t)}isSettingInitialized(){const e=sessionStorage.getItem(a.L.TranslationInitialized);return!!(e&&Date.now()-parseInt(e,10)<36e5)}render(){return e.x`<div> <slot></slot> </div>`}};e._([a.as({context:a.au,subscribe:!0}),e.b()],k.prototype,"translationContextValue",void 0),e._([e.n({type:Boolean,attribute:"is-new-account-age"})],k.prototype,"isNewAccountAge",void 0),e._([e.n({type:Boolean,attribute:"is-new-immersive-visit"})],k.prototype,"isNewImmersiveVisit",void 0),e._([e.n({type:Boolean,attribute:"with-backend-setting"})],k.prototype,"withBackendSetting",void 0),e._([e.n({type:String,attribute:"preferred-languages"})],k.prototype,"preferredLanguages",void 0),e._([e.n({type:Boolean,attribute:"default-immersive-on"})],k.prototype,"defaultImmersiveOn",void 0),k=e._([e.c("translation-settings-admin")],k)}));