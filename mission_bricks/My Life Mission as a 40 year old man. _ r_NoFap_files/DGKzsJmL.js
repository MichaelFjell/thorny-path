SML.di("./CVEbQKiO.js",import.meta.url,"CVEbQKiO");SML.di("./D7lSuCop.js",import.meta.url,"D7lSuCop");SML.di("./CCphb8vV.js",import.meta.url,"CCphb8vV");SML.di("./Mh6HSk7W.js",import.meta.url,"Mh6HSk7W");SML.di("./BZ7lqt1T.js",import.meta.url,"BZ7lqt1T");SML.di("./DZMRR9gi.js",import.meta.url,"DZMRR9gi");SML.di("./BSzJg9M8.js",import.meta.url,"BSzJg9M8");SML.di("./D9dm-Sy6.js",import.meta.url,"D9dm-Sy6");SML.di("./B8BAxqC_.js",import.meta.url,"B8BAxqC_");SML.di("./xsszdj8W.js",import.meta.url,"xsszdj8W");SML.di("./CU4mObWU.js",import.meta.url,"CU4mObWU");
SML.dm("DGKzsJmL",["CVEbQKiO","D7lSuCop","CCphb8vV","Mh6HSk7W","BZ7lqt1T","DZMRR9gi","BSzJg9M8","D9dm-Sy6","B8BAxqC_","xsszdj8W","CU4mObWU"],(async(e,t,i,a)=>{var s,n,o,r;!function(e){e.AgeCollect="age-collect",e.AgeRestrict="age-restrict",e.AgeVerify="age-verify",e.AgeConfirm="age-confirm"}(s||(s={})),function(e){e.UNAVAILABLE_AGE="UNAVAILABLE_AGE",e.UNAVAILABLE_UNVERIFIED_AGE="UNAVAILABLE_UNVERIFIED_AGE",e.UNDER_VERIFIED_AGE="UNDER_VERIFIED_AGE",e.UNVERIFIED_AGE="UNVERIFIED_AGE",e.UNDERAGE="UNDERAGE"}(n||(n={})),function(e){e.BeginVerification="begin-verification"}(o||(o={})),function(e){e.BeginVerification="/svc/shreddit/age-verification/begin-verification"}(r||(r={}));const l="force_age_gating";let c=window.location,h=class extends e.s{constructor(){super(...arguments),this.page=s.AgeCollect,this.postSubmitBehavior="destination",this.successDestination="reload",this.isSettingsCollection=!1,this.countdown=new i.ax(this),this.pubsub=new t.P(this),this.onInputKeypress=e=>{"Enter"===e.key&&this.isValid?this.validateAge():isNaN(e.key)&&e.preventDefault()},this.onInput=()=>{this.clearErrorMessage(),this.saveButton.disabled=!this.isValid},this.redirectToAgeVerificationFlow=async()=>{if(this.withAgeVerification){this.submitButton.disabled=!0;try{const e=await fetch(r.BeginVerification,{body:JSON.stringify({completionUrl:this.getAgeVerificationCompletionUrl(),csrf_token:t.D.get("csrf_token")}),method:"POST"}),{data:i,error:a}=await e.json();if(!e.ok||!i?.continueUrl||a)throw new Error(`Failed to fetch age verification url from ${r.BeginVerification}`);c.href=i.continueUrl}catch(e){this.dispatchError("Something went wrong",t.bt(e)),this.submitButton.disabled=!1;const i=e;window.Sentry?.captureMessage?.(i.message)}}},this.submitAge=async()=>{try{const e=a.g(this.inputs);if(null===e)return;const i=await fetch(t.aN.UpdateBirthdate,{method:"POST",body:JSON.stringify({birthdate:e,csrf_token:t.D.get("csrf_token")})});if(i.ok){if(this.withAgeVerification){const{collection_status:e}=await i.json();if(e===t.cx.Unverified)return void this.redirectToAgeVerificationFlow()}if("destination"===this.postSubmitBehavior)if("reload"===this.successDestination)this.reloadThePage();else{const e=new URL(this.successDestination);e.origin===c.origin&&(c.href=this.successDestination)}else"close"===this.postSubmitBehavior&&(this.pubsub.publish(t.T.AgeGateBirthdateSubmitted,{birthdate:e}),await(this.dialogSheet?.hide()),this.disableCollectionPage(),this.page=s.AgeCollect)}else this.dispatchError("Something went wrong",t.a_.FetchBadResponse)}catch(e){this.dispatchError("Something went wrong",t.bt(e))}},this.validateAge=()=>{const e=a.g(this.inputs);null===e?(this.saveButton.disabled=!0,this.setErrorMessage("Invalid birthdate")):(this.agePlaceholder.date=a.a(e),this.page=s.AgeConfirm)},this.dispatchError=(e,i,a=t.a4.error)=>{const s=t.c("faceplate-alert",{level:a,message:e});this.dispatchEvent(s)},this.updateCountdown=()=>{this.countdownText.textContent=this.countdown.secondsRemaining},this.cancelAndClose=()=>{this.page=s.AgeCollect,this.dialogSheet?.hide()},this.cancelAndRedirect=()=>{this.page=s.AgeRestrict,this.countdown.start(8e3),this.redirectTimeout=setTimeout(this.goHome,8e3)}}get dialogSheet(){return document.querySelector("#age-gate-interstitial")}get inputs(){return[this.querySelector('faceplate-text-input[name="year"]'),this.querySelector('faceplate-text-input[name="month"]'),this.querySelector('faceplate-text-input[name="day"]')].filter(Boolean)}get form(){return this.querySelector("faceplate-form")}get saveButton(){return this.querySelector("#age-gate-submit-btn")}get submitButton(){return this.querySelector(`[slot="${this.page}"] button[slot="primary-button"]`)}get isValid(){return Array.from(this.inputs).every((e=>e.value.length>0&&e.value.length<=(e.maxLength||4)))}get countdownText(){return this.querySelector("#age-restricted-countdown")}get agePlaceholder(){return this.querySelector("#age-date-placeholder")}connectedCallback(){super.connectedCallback(),this.addEventListener("input",this.onInput),this.addEventListener("change",this.onInput),this.inputs?.forEach((e=>e.addEventListener("keypress",this.onInputKeypress))),this.page===s.AgeRestrict&&this.cancelAndRedirect()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("input",this.onInput),this.removeEventListener("change",this.onInput),this.inputs?.forEach((e=>e.removeEventListener("keypress",this.onInputKeypress))),clearTimeout(this.redirectTimeout)}updated(e){super.updated(e),this.countdown.active&&this.updateCountdown()}getAgeVerificationCompletionUrl(){let e=c.origin;e.includes("old.reddit.com")&&(e=e.replace("old.reddit.com","www.reddit.com"));const i=new URL(`${e}/partner/persona/return`),a="reload"===this.successDestination?c.href:this.successDestination,s=new URL(a);s.searchParams.delete(l),i.searchParams.set("destination",s.toString());const n=t.z();return n&&i.searchParams.set("page-type",n),i.searchParams.set("variant","age-verification"),i.toString()}disableCollectionPage(){this.inputs.forEach((e=>{e.disabled=!0})),this.saveButton&&(this.saveButton.disabled=!0)}reloadThePage(){const e=new URL(c.href);e.searchParams.delete(l),e.href===c.href?c.reload():c.href=e.href}goHome(){c.href="/"}setErrorMessage(e){const t=this.form;this.inputs.forEach(((i,a)=>{t?.invalidateFieldWithMessage(i.name,0===a?e:" ")}))}clearErrorMessage(){const e=this.form;this.inputs.forEach((t=>{t.checkValidity()||e?.invalidateFieldWithMessage(t.name,"")}))}render(){return e.x`<slot name="${this.page}"></slot>`}};h.styles=[t.t],e._([e.n({type:Boolean,attribute:"with-age-verification"})],h.prototype,"withAgeVerification",void 0),e._([e.n({type:String,reflect:!0})],h.prototype,"page",void 0),e._([e.n({type:String,attribute:"post-submit-behavior"})],h.prototype,"postSubmitBehavior",void 0),e._([e.n({type:String,attribute:"post-success-destination"})],h.prototype,"successDestination",void 0),e._([e.n({type:Boolean,attribute:"is-settings-collection"})],h.prototype,"isSettingsCollection",void 0),h=e._([e.c("age-gate-dialog")],h)}));